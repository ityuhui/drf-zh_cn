# 主导资源公平性（Dominant Resource Fairness）：多种资源类型的公平分配

作者：Ali Ghodsi, Matei Zaharia, Benjamin Hindman, Andy Konwinski, Scott Shenker, Ion Stoica

加州大学伯克利

## 摘要

在一个包含了不同资源类型的系统里，每一个用户对每一种资源都有不同的需求。为了能够在这样一个系统里公平的分配资源，我们提出了主导资源公平性 Dominant Resource Fairness（DRF）算法，一个对多种资源类型的“最大-最小公平”的概括方法。与其他的方法不同，DRF有着非常可取的特性。

首先，DRF通过确保在资源不足的情况下没有用户从中受益，从而激励用户共享资源，将资源在它们之间平均分配。

其次，DRF可以保证, 用户无法通过撒谎来获得更多的资源。

再次，DRF分配资源后，用户不羡慕彼此，即没有用户想要和其他用户交易其分配到的资源。

最后，DRF是Pareto高效的，即在不降低一个用户分配的资源时，不可能提高另一个用户分配的资源。

我们已经在Mesos集群的资源管理器里实现了DRF算法，结果显示，与一些最新的资源调度器里提供的、基于slot的公平分享算法相比，DRF可以带来更好的吞吐量和更公平的分配。

## 介绍

分配资源是任何共享计算机系统的重要功能。迄今为止，“最大-最小公平”是最流行的分配策略之一，该策略最大化了一个用户在系统里收到的最小分配。假设每一个用户都有足够的需求，则该策略为每一个用户平均分配这些资源。“最大-最小公平”还包含了“权”的概念，每一个用户收到的资源份额与其权重成正比。

加权的“最大-最小公平”算法的吸引力在于，它很通用，可以支持多种其他的资源分配算法，如基于优先级、资源预留、以及截止日期 [31]。它还确保隔离性，即不管其他用户的需求如何，一个用户一定会收到它的份额。

因为有了上述优点，大量的基于加权“最大-最小公平”算法被提出来，如轮询、按比例共享资源【32】、加权公平排队【12】，这些算法可以被应用于各种资源的分配，包括链路宽带【8，12，15，24，27，29】，CPU【11，28，31】，内存【4，31】以及存储器【5】。

虽然已经有了大量的公平分配算法，但是迄今为止，它们主要关注于单个资源类型的分配。即使在多资源环境下（用户需要不同种类的资源），也总是将其抽象成单个资源来分配。例如，两种广泛使用的集群计算框架：Hadoop和Dryad【1，18，34】，使用的公平调度器，将节点的资源分成固定大小的分区（称之为slot），将其作为调度单元。尽管事实上，集群里的不同任务对CPU、内存和I/O资源的需求非常不同。

在本文中，我们解决了用户对多种类型资源的不同需求的公平分配问题。特别是，我们提出了主导资源公平性（DRF）算法，即对多种资源的“最大-最小公平性”的概况。DRF算法背后的直觉是，在多类别资源环境中，一个用户得到的资源应由该用户的主导资源的份额来确定（主导资源是指用户得到的各种资源里的最大份额）。简而言之，DRF算法寻求最大化所有用户的最小主导份额。举例来说，如果用户A运行着CPU密集型的任务，用户B运行着内存密集型的任务，DRF尝试让用户A的CPU份额和用户B的内存份额相等。在单一资源类型的情况下，DRF退化成该资源的“最大-最小公平”算法。

DRF算法的优点是，它可以满足一些特性，而这些特性在多种资源的情况下是很难得到满足的（在单一资源的情况下比较容易）。对于诸如共享激励、预防策略、Pareto高效以及无嫉妒，DRF算法保证在一个静态并且平等分配资源的系统里，没有用户会过得更好，从而激励用户共享资源。进一步说，DRF算法具有预防策略，没有用户可以通过撒谎来获得更多的资源。DRF是Pareto高效的，即在不抢占已经分配出去的资源的情况下，它尽可能的分配资源以满足其他的属性。最后，DRF是不产生嫉妒的，没有用户想要别人的资源。而其他的解决方案至少会违反上面的一个属性。例如，在微观经济学里的优先公平分配机制【3，22，33】，以及平等参与的竞争均衡【3】都不具有预防策略。

我们已经在Mesos【16】（一个运行于多种集群计算框架如Hadoop、MPI上的资源管理器）里实现并评估了DRF算法。与Hadoop和Dryad里采用的基于slot的公平分享算法相比，基于slot的公平分享算法会带来更糟糕的性能，对特定的工作负载的不公平的惩罚，以及更加虚弱的隔离性。

尽管本文着重于数据中心的资源分配，但我们认为DRF算法通常也适用于用户有不同需求的其他的多资源环境，例如在多核计算机中。

本文的其余部分安排如下：第2节提出了多资源的公平性问题。第3节列出了我们想要考虑的公平性的属性。第4节介绍DRF算法。第5节介绍公平性的替代概念。第6节则分析了DRF算法和其他算法的属性。第7节提供了在Facebook Hadoop集群中的实验​​结果。第8节中对相关工作进行了调查。第9节中进行了总结。

## 动机

之前，关于加权的“最大-最小公平性”算法专注于单一资源，但是随着云计算和多核处理器的出现，对具有多个资源以及不同的用户需求的环境里的资源分配算法的需求逐渐增多。多个资源是指不同类型的资源，而不是同一类可互换的多个资源。

为了弄清楚多资源分配的需求，我们绘制了一副图（图1），该图追踪了在一个月（2010年10月）的时间里，Facebook的一个2000个节点的Hadoop集群的资源分配情况，图1中的一个圆圈代表某个任务消耗的内存和CPU资源。圆的大小是该圆所在区域里的任务的数量的对数。虽然大多数任务是CPU密集性的，但也有一些内存密集型的任务（尤其是reduce操作）。

现有的集群中使用的公平调度器，如Quincy【18】和Hadoop公平调度器【2，34】，都忽略了用户的异构请求（对多种资源的不同请求），以粗粒度的slot(一个slot是一个节点的全部资源中的固定的一部分)来分配资源。因为slot通常与任务要求的资源不匹配，从而导致分配效率的低下。

图2量化了Hadoop MapReduce里公平调度器【2，34】提供的公平和隔离的级别。该图展示了任务对CPU的需求和slot的CPU份额之间的比率，以及任务对内存的需求和slot的内存份额之间的比率。我们通过将总的内存和CPU数量除以slot的个数，计算出每个slot对应的CPU和内存份额。比率等于1代表任务需求和slot资源之间完美匹配，比率低于1代表任务未充分利用其slot资源，比率高于1对应任务过度利用其slot资源，这可能会导致颠簸。图2显示大多数任务要么使用不足，要么过度使用了其slot资源。

状态-->正在翻译
